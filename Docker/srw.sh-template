#!/bin/bash
set -x
export FI_PROVIDER=tcp
export SINGULARITYENV_FI_PROVIDER_PATH=/opt/spack-stack/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.4.0/intel-oneapi-mpi-2021.6.0-oeymd7y2mkbdxex2tzf7354yhwpnvhoq/mpi/2021.6.0/libfabric/lib/prov:/usr/lib64/libfabric
export SINGULARITYENV_LD_LIBRARY_PATH=/opt/spack-stack/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.4.0/intel-oneapi-compilers-2022.1.0-zxncne6kxsvmecyl42ukojl54l5wsbjz/compiler/2022.1.0/linux/lib:/opt/spack-stack/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.4.0/intel-oneapi-compilers-2022.1.0-zxncne6kxsvmecyl42ukojl54l5wsbjz/compiler/2022.1.0/linux/lib/x64:/opt/spack-stack/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.4.0/intel-oneapi-compilers-2022.1.0-zxncne6kxsvmecyl42ukojl54l5wsbjz/compiler/2022.1.0/linux/lib/oclfpga/host/linux64/lib:/opt/spack-stack/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.4.0/intel-oneapi-compilers-2022.1.0-zxncne6kxsvmecyl42ukojl54l5wsbjz/compiler/2022.1.0/linux/compiler/lib/intel64_lin:/opt/spack-stack/envs/ufs-srw.intel/install/intel/2021.6.0/jasper-2.0.25-llokljd/lib:/opt/spack-stack/envs/ufs-srw.intel/install/intel/2021.6.0/libjpeg-turbo-2.1.0-34z3tmq/lib:/opt/spack-stack/envs/ufs-srw.intel/install/intel/2021.6.0/libpng-1.6.37-jbyhqcl/lib:/opt/spack-stack/envs/ufs-srw.intel/install/intel/2021.6.0/netcdf-fortran-4.5.4-4vnukda/lib:/opt/spack-stack/envs/ufs-srw.intel/install/intel/2021.6.0/netcdf-c-4.7.4-ifadjij/lib:/opt/spack-stack/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.4.0/intel-oneapi-mpi-2021.6.0-oeymd7y2mkbdxex2tzf7354yhwpnvhoq/mpi/2021.6.0/libfabric/lib:/opt/spack-stack/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.4.0/intel-oneapi-mpi-2021.6.0-oeymd7y2mkbdxex2tzf7354yhwpnvhoq/mpi/2021.6.0/lib/release:/opt/spack-stack/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.4.0/intel-oneapi-mpi-2021.6.0-oeymd7y2mkbdxex2tzf7354yhwpnvhoq/mpi/2021.6.0/lib:/.singularity.d/libs:/.singularity.d/libs
export SINGULARITYENV_PATH=/opt/spack-stack/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.4.0/intel-oneapi-compilers-2022.1.0-zxncne6kxsvmecyl42ukojl54l5wsbjz/compiler/2022.1.0/linux/lib/oclfpga/bin:/opt/spack-stack/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.4.0/intel-oneapi-compilers-2022.1.0-zxncne6kxsvmecyl42ukojl54l5wsbjz/compiler/2022.1.0/linux/bin/intel64:/opt/spack-stack/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.4.0/intel-oneapi-compilers-2022.1.0-zxncne6kxsvmecyl42ukojl54l5wsbjz/compiler/2022.1.0/linux/bin:/opt/ufs-srweather-app/bin:/opt/spack-stack/envs/ufs-srw.intel/install/intel/2021.6.0/jasper-2.0.25-llokljd/bin:/opt/spack-stack/envs/ufs-srw.intel/install/intel/2021.6.0/libjpeg-turbo-2.1.0-34z3tmq/bin:/opt/spack-stack/envs/ufs-srw.intel/install/intel/2021.6.0/libpng-1.6.37-jbyhqcl/bin:/opt/spack-stack/envs/ufs-srw.intel/install/intel/2021.6.0/netcdf-fortran-4.5.4-4vnukda/bin:/opt/spack-stack/envs/ufs-srw.intel/install/intel/2021.6.0/netcdf-c-4.7.4-ifadjij/bin:/opt/spack-stack/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.4.0/intel-oneapi-mpi-2021.6.0-oeymd7y2mkbdxex2tzf7354yhwpnvhoq/mpi/2021.6.0/libfabric/bin:/opt/spack-stack/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.4.0/intel-oneapi-mpi-2021.6.0-oeymd7y2mkbdxex2tzf7354yhwpnvhoq/mpi/2021.6.0/bin:/opt/spack-stack/spack/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/ufs-srweather-app/regional_workflow/scripts:/opt/ufs-srweather-app/container-bin:/opt/spack-stack/envs/ufs-srw.intel/install/intel/2021.6.0/netcdf-c-4.7.4-ifadjij/bin
export SINGULARITYENV_CONDA_PREFIX=/opt/miniconda/envs/regional_workflow
export SINGULARITYENV_CONDA_DEFAULT_ENV=regional_workflow
export SINGULARITYENV_SRW_ENV=regional_workflow
export SINGULARITY_SHELL=/bin/bash
dir="$(dirname $(readlink -f ${BASH_SOURCE[0]}))"
#img="ubuntu20.04-intel22-ufs-srwapp.img"
img="IMAGE"
cmd=$(basename "$0")
arg="$@"
echo running: singularity exec "${dir}/${img}" $cmd $arg
singularity exec -B /BINDDIR:/BINDDIR "${dir}/${img}" $cmd $arg

